import streamlit as st
import pandas as pd

# ==========================================
# 1. ç³»çµ±è¨­å®šèˆ‡æ¨™é¡Œ
# ==========================================
st.set_page_config(page_title="JAMESç¤¾å®…ç§Ÿé‡‘è©•å®šæ¸¬è©¦", page_icon="ğŸ ")

st.title("ğŸ  JAMES - ä¸­å€ç§Ÿé‡‘è©•å®šæ¸¬è©¦ç‰ˆ")
st.caption("åƒ…ä¾›è©¦ç®—åƒè€ƒï¼Œå¯¦éš›è¦ä»¥ä¸­å¿ƒå…¬æœƒå¯©æ ¸ç‚ºä¸»")
st.markdown("---")
# ==========================================
# 2. å®šç¾©è³‡æ–™åº« (Data Definitions)
# ==========================================

# ----------------- è‡ºä¸­å¸‚ -----------------
taichung_whole = {
    'è¡Œæ”¿å€': ['è¥¿å±¯å€', 'åŒ—å±¯å€', 'å—å±¯å€', 'åŒ—å€', 'è¥¿å€', 'ä¸­å€', 'æ±å€', 'çƒæ—¥å€', 'å—å€', 'å¤§é‡Œå€', 'å¤ªå¹³å€', 'æ½­å­å€', 'è±åŸå€', 'åé‡Œå€', 'æ²™é¹¿å€', 'é¾äº•å€', 'å¤§è‚šå€', 'å¤§é›…å€', 'ç¥å²¡å€', 'æ¢§æ£²å€', 'æ¸…æ°´å€', 'å¤§ç”²å€', 'å¤–åŸ”å€', 'éœ§å³°å€', 'çŸ³å²¡å€', 'æ±å‹¢å€', 'æ–°ç¤¾å€', 'å…¶ä»–'],
    '0-5å¹´': [940, 900, 900, 890, 890, 830, 830, 830, 780, 770, 770, 770, 770, 675, 675, 675, 660, 660, 660, 600, 580, 565, 505, 505, 495, 460, 445, 375],
    '5-10å¹´': [925, 885, 885, 875, 875, 815, 815, 815, 770, 760, 760, 760, 760, 665, 665, 665, 650, 650, 650, 590, 570, 555, 500, 500, 485, 450, 440, 370],
    '10-15å¹´': [905, 870, 870, 860, 860, 805, 805, 805, 755, 745, 745, 745, 745, 650, 650, 650, 640, 640, 640, 580, 560, 550, 490, 490, 480, 445, 430, 360],
    '15-20å¹´': [885, 850, 850, 840, 840, 780, 780, 780, 735, 725, 725, 725, 725, 635, 635, 635, 625, 625, 625, 565, 545, 535, 475, 475, 465, 430, 420, 355],
    '20-25å¹´': [860, 830, 830, 815, 815, 760, 760, 760, 720, 705, 705, 705, 705, 620, 620, 620, 605, 605, 605, 550, 530, 520, 465, 465, 455, 420, 410, 345],
    '25-30å¹´': [835, 805, 805, 795, 795, 740, 740, 740, 700, 685, 685, 685, 685, 600, 600, 600, 590, 590, 590, 535, 515, 505, 450, 450, 440, 410, 400, 335],
    '30-35å¹´': [815, 780, 780, 770, 770, 720, 720, 720, 680, 670, 670, 670, 670, 585, 585, 585, 575, 575, 575, 520, 500, 490, 440, 440, 430, 400, 385, 325],
    '35-40å¹´': [780, 750, 750, 740, 740, 690, 690, 690, 650, 640, 640, 640, 640, 560, 560, 560, 550, 550, 550, 500, 480, 470, 420, 420, 410, 380, 370, 310],
    '40å¹´ä»¥ä¸Š': [745, 715, 715, 705, 705, 660, 660, 660, 620, 610, 610, 610, 610, 535, 535, 535, 525, 525, 525, 475, 460, 450, 400, 400, 390, 365, 355, 295]
}
taichung_studio = {
    'è¡Œæ”¿å€': ['è¥¿å±¯å€', 'åŒ—å±¯å€', 'å—å±¯å€', 'åŒ—å€', 'è¥¿å€', 'ä¸­å€', 'æ±å€', 'å—å€', 'çƒæ—¥å€', 'å¤§é›…å€', 'æ½­å­å€', 'å¤§é‡Œå€', 'å¤ªå¹³å€', 'æ²™é¹¿å€', 'åé‡Œå€', 'å¤§è‚šå€', 'ç¥å²¡å€', 'è±åŸå€', 'æ¢§æ£²å€', 'é¾äº•å€', 'å¤§ç”²å€', 'å¤–åŸ”å€', 'çŸ³å²¡å€', 'éœ§å³°å€', 'æ¸…æ°´å€', 'æ–°ç¤¾å€', 'æ±å‹¢å€', 'å…¶ä»–'],
    '0-5å¹´': [1120, 1060, 1060, 1045, 1045, 1010, 1010, 985, 940, 915, 915, 890, 890, 890, 855, 840, 840, 840, 830, 830, 780, 720, 720, 720, 590, 480, 480, 385],
    '5-10å¹´': [1100, 1040, 1040, 1030, 1030, 995, 995, 970, 925, 900, 900, 875, 875, 875, 840, 830, 830, 830, 815, 815, 770, 710, 710, 710, 580, 475, 475, 380],
    '10-15å¹´': [1080, 1025, 1025, 1010, 1010, 975, 975, 955, 905, 885, 885, 860, 860, 860, 825, 815, 815, 815, 805, 805, 755, 700, 700, 700, 570, 465, 465, 375],
    '15-20å¹´': [1055, 995, 995, 985, 985, 950, 950, 930, 885, 860, 860, 840, 840, 840, 805, 795, 795, 795, 780, 780, 735, 680, 680, 680, 555, 455, 455, 365],
    '20-25å¹´': [1025, 970, 970, 960, 960, 925, 925, 905, 860, 840, 840, 815, 815, 815, 785, 775, 775, 775, 760, 760, 720, 660, 660, 660, 540, 445, 445, 355],
    '25-30å¹´': [1000, 945, 945, 935, 935, 900, 900, 880, 835, 815, 815, 795, 795, 795, 760, 750, 750, 750, 740, 740, 700, 645, 645, 645, 525, 430, 430, 345],
    '30-35å¹´': [970, 920, 920, 905, 905, 875, 875, 855, 815, 795, 795, 770, 770, 770, 740, 730, 730, 730, 720, 720, 680, 625, 625, 625, 510, 420, 420, 335],
    '35-40å¹´': [930, 880, 880, 870, 870, 840, 840, 820, 780, 760, 760, 740, 740, 740, 710, 700, 700, 700, 690, 690, 650, 600, 600, 600, 490, 400, 400, 320],
    '40å¹´ä»¥ä¸Š': [885, 840, 840, 830, 830, 800, 800, 780, 745, 725, 725, 705, 705, 705, 675, 665, 665, 665, 660, 660, 620, 570, 570, 570, 470, 380, 380, 305]
}

# ----------------- æ–°ç«¹ -----------------
hsinchu_all_whole = {
    'è¡Œæ”¿å€': ['ç«¹åŒ—å¸‚', 'æ–°ç«¹å¸‚', 'å¯¶å±±é„‰', 'æ¹–å£é„‰', 'æ–°åŸ”é®', 'ç«¹æ±é®', 'æ–°è±é„‰', 'èŠæ—é„‰', 'é—œè¥¿é®', 'å…¶ä»–'],
    '0-5å¹´': [805, 780, 675, 675, 650, 650, 625, 480, 480, 375],
    '5-10å¹´': [795, 770, 665, 665, 640, 640, 615, 475, 475, 370],
    '10-15å¹´': [780, 755, 650, 650, 630, 630, 605, 465, 465, 360],
    '15-20å¹´': [760, 735, 635, 635, 615, 615, 590, 455, 455, 355],
    '20-25å¹´': [740, 720, 620, 620, 595, 595, 575, 445, 445, 345],
    '25-30å¹´': [720, 700, 600, 600, 580, 580, 560, 430, 430, 335],
    '30-35å¹´': [700, 680, 585, 585, 565, 565, 545, 420, 420, 325],
    '35-40å¹´': [670, 650, 560, 560, 540, 540, 520, 400, 400, 310],
    '40å¹´ä»¥ä¸Š': [640, 620, 535, 535, 515, 515, 495, 380, 380, 295]
}
hsinchu_all_studio = {
    'è¡Œæ”¿å€': ['æ–°ç«¹å¸‚', 'ç«¹åŒ—å¸‚', 'å¯¶å±±é„‰', 'æ–°åŸ”é®', 'æ¹–å£é„‰', 'ç«¹æ±é®', 'æ–°è±é„‰', 'èŠæ—é„‰', 'é—œè¥¿é®', 'å…¶ä»–'],
    '0-5å¹´': [1105, 1080, 855, 855, 855, 855, 830, 700, 600, 385],
    '5-10å¹´': [1090, 1065, 840, 840, 840, 840, 815, 685, 590, 380],
    '10-15å¹´': [1070, 1045, 825, 825, 825, 825, 805, 675, 580, 375],
    '15-20å¹´': [1040, 1020, 805, 805, 805, 805, 780, 660, 565, 365],
    '20-25å¹´': [1015, 995, 785, 785, 785, 785, 760, 640, 550, 355],
    '25-30å¹´': [985, 965, 760, 760, 760, 760, 740, 625, 535, 345],
    '30-35å¹´': [960, 940, 740, 740, 740, 740, 720, 605, 520, 335],
    '35-40å¹´': [920, 900, 710, 710, 710, 710, 690, 580, 500, 320],
    '40å¹´ä»¥ä¸Š': [875, 855, 675, 675, 675, 675, 660, 555, 475, 305]
}

# ----------------- å½°åŒ– -----------------
changhua_whole = {
    'è¡Œæ”¿å€': ['å“¡æ—å¸‚', 'å½°åŒ–å¸‚', 'å’Œç¾é®', 'é¹¿æ¸¯é®', 'ç§€æ°´é„‰', 'ç¤¾é ­é„‰', 'äºŒæ—é®', 'å¤§æ‘é„‰', 'ç·šè¥¿é„‰', 'èŠ±å£‡é„‰', 'ä¼¸æ¸¯é„‰', 'åŒ—æ–—é®', 'åŸ”å¿ƒé„‰', 'åŸ”é¹½é„‰', 'åŸ¤é ­é„‰', 'æ°¸é–é„‰', 'æºªå·é„‰', 'æºªæ¹–é®', 'ç”°ä¸­é®', 'ç”°å°¾é„‰', 'ç¦èˆˆé„‰', 'ç«¹å¡˜é„‰', 'èŠ³è‹‘é„‰', 'å…¶ä»–'],
    '0-5å¹´': [600, 600, 555, 505, 480, 470, 445, 445, 445, 445, 435, 435, 400, 400, 400, 400, 400, 400, 400, 400, 400, 400, 400, 375],
    '5-10å¹´': [590, 590, 545, 500, 475, 465, 440, 440, 440, 440, 425, 425, 390, 390, 390, 390, 390, 390, 390, 390, 390, 390, 390, 370],
    '10-15å¹´': [580, 580, 535, 490, 465, 455, 430, 430, 430, 430, 420, 420, 385, 385, 385, 385, 385, 385, 385, 385, 385, 385, 385, 360],
    '15-20å¹´': [565, 565, 520, 475, 455, 445, 420, 420, 420, 420, 410, 410, 375, 375, 375, 375, 375, 375, 375, 375, 375, 375, 375, 355],
    '20-25å¹´': [550, 550, 510, 465, 445, 430, 410, 410, 410, 410, 400, 400, 365, 365, 365, 365, 365, 365, 365, 365, 365, 365, 365, 345],
    '25-30å¹´': [535, 535, 495, 450, 430, 420, 400, 400, 400, 400, 390, 390, 355, 355, 355, 355, 355, 355, 355, 355, 355, 355, 355, 335],
    '30-35å¹´': [520, 520, 480, 440, 420, 410, 385, 385, 385, 385, 375, 375, 345, 345, 345, 345, 345, 345, 345, 345, 345, 345, 345, 325],
    '35-40å¹´': [500, 500, 460, 420, 400, 390, 370, 370, 370, 370, 360, 360, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 330, 310],
    '40å¹´ä»¥ä¸Š': [475, 475, 440, 400, 380, 375, 355, 355, 355, 355, 345, 345, 315, 315, 315, 315, 315, 315, 315, 315, 315, 315, 315, 295]
}
changhua_studio = {
    'è¡Œæ”¿å€': ['å½°åŒ–å¸‚', 'å“¡æ—å¸‚', 'å’Œç¾é®', 'ç§€æ°´é„‰', 'é¹¿æ¸¯é®', 'æºªæ¹–é®', 'ç”°ä¸­é®', 'ç¤¾é ­é„‰', 'äºŒæ—é®', 'å¤§æ‘é„‰', 'ç·šè¥¿é„‰', 'èŠ±å£‡é„‰', 'ä¼¸æ¸¯é„‰', 'åŒ—æ–—é®', 'åŸ”å¿ƒé„‰', 'åŸ”é¹½é„‰', 'åŸ¤é ­é„‰', 'æ°¸é–é„‰', 'æºªå·é„‰', 'ç”°å°¾é„‰', 'ç¦èˆˆé„‰', 'ç«¹å¡˜é„‰', 'èŠ³è‹‘é„‰', 'å…¶ä»–'],
    '0-5å¹´': [745, 675, 565, 565, 565, 480, 480, 480, 460, 460, 460, 460, 445, 445, 410, 410, 410, 410, 410, 410, 410, 410, 410, 385],
    '5-10å¹´': [735, 665, 555, 555, 555, 475, 475, 475, 450, 450, 450, 450, 440, 440, 405, 405, 405, 405, 405, 405, 405, 405, 405, 380],
    '10-15å¹´': [720, 650, 550, 550, 550, 465, 465, 465, 445, 445, 445, 445, 430, 430, 395, 395, 395, 395, 395, 395, 395, 395, 395, 375],
    '15-20å¹´': [705, 635, 535, 535, 535, 455, 455, 455, 430, 430, 430, 430, 420, 420, 385, 385, 385, 385, 385, 385, 385, 385, 385, 365],
    '20-25å¹´': [685, 620, 520, 520, 520, 445, 445, 445, 420, 420, 420, 420, 410, 410, 375, 375, 375, 375, 375, 375, 375, 375, 375, 355],
    '25-30å¹´': [665, 600, 505, 505, 505, 430, 430, 430, 410, 410, 410, 410, 400, 400, 365, 365, 365, 365, 365, 365, 365, 365, 365, 345],
    '30-35å¹´': [645, 585, 490, 490, 490, 420, 420, 420, 400, 400, 400, 400, 385, 385, 355, 355, 355, 355, 355, 355, 355, 355, 355, 335],
    '35-40å¹´': [620, 560, 470, 470, 470, 400, 400, 400, 380, 380, 380, 380, 370, 370, 340, 340, 340, 340, 340, 340, 340, 340, 340, 320],
    '40å¹´ä»¥ä¸Š': [590, 535, 450, 450, 450, 380, 380, 380, 365, 365, 365, 365, 355, 355, 325, 325, 325, 325, 325, 325, 325, 325, 325, 305]
}

# ----------------- å—æŠ• -----------------
nantou_whole = {
    'è¡Œæ”¿å€': ['è‰å±¯é®', 'å—æŠ•å¸‚', 'åŸ”é‡Œé®', 'ç«¹å±±é®', 'åé–“é„‰', 'æ°´é‡Œé„‰', 'é›†é›†é®', 'é­šæ± é„‰', 'é¹¿è°·é„‰', 'å…¶ä»–'],
    '0-5å¹´': [625, 600, 580, 435, 410, 400, 400, 400, 400, 375],
    '5-10å¹´': [615, 590, 570, 425, 405, 390, 390, 390, 390, 370],
    '10-15å¹´': [605, 580, 560, 420, 395, 385, 385, 385, 385, 360],
    '15-20å¹´': [590, 565, 545, 410, 385, 375, 375, 375, 375, 355],
    '20-25å¹´': [575, 550, 530, 400, 375, 365, 365, 365, 365, 345],
    '25-30å¹´': [560, 535, 515, 390, 365, 355, 355, 355, 355, 335],
    '30-35å¹´': [545, 520, 500, 375, 355, 345, 345, 345, 345, 325],
    '35-40å¹´': [520, 500, 480, 360, 340, 330, 330, 330, 330, 310],
    '40å¹´ä»¥ä¸Š': [495, 475, 460, 345, 325, 315, 315, 315, 315, 295]
}
nantou_studio = {
    'è¡Œæ”¿å€': ['å—æŠ•å¸‚', 'è‰å±¯é®', 'åŸ”é‡Œé®', 'ç«¹å±±é®', 'åé–“é„‰', 'æ°´é‡Œé„‰', 'é›†é›†é®', 'é­šæ± é„‰', 'é¹¿è°·é„‰', 'å…¶ä»–'],
    '0-5å¹´': [660, 660, 600, 480, 420, 420, 420, 420, 420, 385],
    '5-10å¹´': [650, 650, 590, 475, 415, 415, 415, 415, 415, 380],
    '10-15å¹´': [640, 640, 580, 465, 410, 410, 410, 410, 410, 375],
    '15-20å¹´': [625, 625, 565, 455, 400, 400, 400, 400, 400, 365],
    '20-25å¹´': [605, 605, 550, 445, 390, 390, 390, 390, 390, 355],
    '25-30å¹´': [590, 590, 535, 430, 375, 375, 375, 375, 375, 345],
    '30-35å¹´': [575, 575, 520, 420, 365, 365, 365, 365, 365, 335],
    '35-40å¹´': [550, 550, 500, 400, 350, 350, 350, 350, 350, 320],
    '40å¹´ä»¥ä¸Š': [525, 525, 475, 380, 335, 335, 335, 335, 335, 305]
}

# ----------------- å˜‰ç¾© -----------------
chiayi_all_whole = {
    'è¡Œæ”¿å€': ['å˜‰ç¾©å¸‚', 'å¤ªä¿å¸‚', 'ä¸­åŸ”é„‰', 'å¤§æ—é®', 'æœ´å­å¸‚', 'æ°‘é›„é„‰', 'ç«¹å´é„‰', 'å…­è…³é„‰', 'å¸ƒè¢‹é®', 'æ–°æ¸¯é„‰', 'æ¢…å±±é„‰', 'æ°´ä¸Šé„‰', 'æºªå£é„‰', 'ç•ªè·¯é„‰', 'ç¾©ç«¹é„‰', 'å…¶ä»–'],
    '0-5å¹´': [600, 530, 495, 480, 480, 480, 410, 400, 400, 400, 400, 400, 400, 400, 400, 375],
    '5-10å¹´': [590, 520, 485, 475, 475, 475, 405, 390, 390, 390, 390, 390, 390, 390, 390, 370],
    '10-15å¹´': [580, 515, 480, 465, 465, 465, 395, 385, 385, 385, 385, 385, 385, 385, 385, 360],
    '15-20å¹´': [565, 500, 465, 455, 455, 455, 385, 375, 375, 375, 375, 375, 375, 375, 375, 355],
    '20-25å¹´': [550, 485, 455, 445, 445, 445, 375, 365, 365, 365, 365, 365, 365, 365, 365, 345],
    '25-30å¹´': [535, 475, 440, 430, 430, 430, 365, 355, 355, 355, 355, 355, 355, 355, 355, 335],
    '30-35å¹´': [520, 460, 430, 420, 420, 420, 355, 345, 345, 345, 345, 345, 345, 345, 345, 325],
    '35-40å¹´': [500, 440, 410, 400, 400, 400, 340, 330, 330, 330, 330, 330, 330, 330, 330, 310],
    '40å¹´ä»¥ä¸Š': [475, 420, 390, 380, 380, 380, 325, 315, 315, 315, 315, 315, 315, 315, 315, 295]
}
chiayi_all_studio = {
    'è¡Œæ”¿å€': ['å˜‰ç¾©å¸‚', 'å¤ªä¿å¸‚', 'æœ´å­å¸‚', 'ä¸­åŸ”é„‰', 'å¤§æ—é®', 'æ°‘é›„é„‰', 'ç•ªè·¯é„‰', 'å…­è…³é„‰', 'å¸ƒè¢‹é®', 'æ–°æ¸¯é„‰', 'æ¢…å±±é„‰', 'æ°´ä¸Šé„‰', 'æºªå£é„‰', 'ç«¹å´é„‰', 'ç¾©ç«¹é„‰', 'å…¶ä»–'],
    '0-5å¹´': [820, 805, 720, 530, 530, 530, 530, 420, 420, 420, 420, 420, 420, 420, 420, 385],
    '5-10å¹´': [805, 795, 710, 520, 520, 520, 520, 415, 415, 415, 415, 415, 415, 415, 415, 380],
    '10-15å¹´': [790, 780, 700, 515, 515, 515, 515, 410, 410, 410, 410, 410, 410, 410, 410, 375],
    '15-20å¹´': [770, 760, 680, 500, 500, 500, 500, 400, 400, 400, 400, 400, 400, 400, 400, 365],
    '20-25å¹´': [750, 740, 660, 485, 485, 485, 485, 390, 390, 390, 390, 390, 390, 390, 390, 355],
    '25-30å¹´': [730, 720, 645, 475, 475, 475, 475, 375, 375, 375, 375, 375, 375, 375, 375, 345],
    '30-35å¹´': [710, 700, 625, 460, 460, 460, 460, 365, 365, 365, 365, 365, 365, 365, 365, 335],
    '35-40å¹´': [680, 670, 600, 440, 440, 440, 440, 350, 350, 350, 350, 350, 350, 350, 350, 320],
    '40å¹´ä»¥ä¸Š': [650, 640, 570, 420, 420, 420, 420, 335, 335, 335, 335, 335, 335, 335, 335, 305]
}

# ----------------- è³‡æ–™æ•´åˆé‚è¼¯ -----------------
# å»ºç«‹è³‡æ–™æŸ¥è©¢å‡½æ•¸
def get_dataset(county, house_type):
    # è‡ºä¸­
    if county == 'è‡ºä¸­å¸‚':
        return pd.DataFrame(taichung_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(taichung_studio)
    
    # æ–°ç«¹å¸‚ (è¡Œæ”¿å€åªå«æ–°ç«¹å¸‚)
    elif county == 'æ–°ç«¹å¸‚':
        df = pd.DataFrame(hsinchu_all_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(hsinchu_all_studio)
        return df[df['è¡Œæ”¿å€'] == 'æ–°ç«¹å¸‚']
    
    # æ–°ç«¹ç¸£ (è¡Œæ”¿å€æ’é™¤æ–°ç«¹å¸‚)
    elif county == 'æ–°ç«¹ç¸£':
        df = pd.DataFrame(hsinchu_all_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(hsinchu_all_studio)
        return df[df['è¡Œæ”¿å€'] != 'æ–°ç«¹å¸‚']
    
    # å½°åŒ–
    elif county == 'å½°åŒ–ç¸£':
        return pd.DataFrame(changhua_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(changhua_studio)
    
    # å—æŠ•
    elif county == 'å—æŠ•ç¸£':
        return pd.DataFrame(nantou_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(nantou_studio)
    
    # å˜‰ç¾©å¸‚
    elif county == 'å˜‰ç¾©å¸‚':
        df = pd.DataFrame(chiayi_all_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(chiayi_all_studio)
        return df[df['è¡Œæ”¿å€'] == 'å˜‰ç¾©å¸‚']
    
    # å˜‰ç¾©ç¸£
    elif county == 'å˜‰ç¾©ç¸£':
        df = pd.DataFrame(chiayi_all_whole) if house_type == 'æ•´å±¤(æˆ¶)' else pd.DataFrame(chiayi_all_studio)
        return df[df['è¡Œæ”¿å€'] != 'å˜‰ç¾©å¸‚']
    
    return pd.DataFrame()

# å–å¾—è©²ç¸£å¸‚ç§Ÿé‡‘ä¸Šé™
def get_rent_limit(county, house_type):
    # ç´šè·äºŒ (æ–°åŒ—ã€æ¡ƒåœ’ã€è‡ºä¸­ã€æ–°ç«¹å¸‚ã€æ–°ç«¹ç¸£) -> 35,000 / 21,000
    tier_2 = ['è‡ºä¸­å¸‚', 'æ–°ç«¹å¸‚', 'æ–°ç«¹ç¸£']
    
    if county in tier_2:
        return 35000 if house_type == 'æ•´å±¤(æˆ¶)' else 21000
    else:
        # å…¶ä»–ç¸£å¸‚ (å½°åŒ–ã€å—æŠ•ã€å˜‰ç¾©ç­‰) -> 22,000 / 14,000
        return 22000 if house_type == 'æ•´å±¤(æˆ¶)' else 14000

# ==========================================
# 3. å»ºç«‹æ“ä½œä»‹é¢
# ==========================================

col1, col2 = st.columns(2)

with col1:
    county_list = ['è‡ºä¸­å¸‚', 'æ–°ç«¹å¸‚', 'æ–°ç«¹ç¸£', 'å½°åŒ–ç¸£', 'å—æŠ•ç¸£', 'å˜‰ç¾©å¸‚', 'å˜‰ç¾©ç¸£']
    selected_county = st.selectbox("1. é¸æ“‡ç¸£å¸‚", county_list)
    
    house_type = st.radio("2. ç‰©ä»¶é¡å‹", ["æ•´å±¤(æˆ¶)", "ç¨ç«‹å¥—æˆ¿"], horizontal=True)
    
    # æ ¹æ“šç¸£å¸‚èˆ‡é¡å‹å–å¾—å°æ‡‰çš„è³‡æ–™è¡¨èˆ‡è¡Œæ”¿å€æ¸…å–®
    current_df = get_dataset(selected_county, house_type)
    district_list = current_df['è¡Œæ”¿å€'].tolist() if not current_df.empty else []
    
    selected_district = st.selectbox("3. è¡Œæ”¿å€", district_list)
    
    ages = ['0-5å¹´', '5-10å¹´', '10-15å¹´', '15-20å¹´', '20-25å¹´', '25-30å¹´', '30-35å¹´', '35-40å¹´', '40å¹´ä»¥ä¸Š']
    selected_age = st.selectbox("4. å±‹é½¡å€é–“", ages)
    
    area = st.number_input("5. ç‰©ä»¶åªæ•¸", min_value=1.0, value=25.0, step=0.1, format="%.2f")

with col2:
    # å€ä½èˆ‡è£ä¿®é‚è¼¯
    loc_options = {"å„ªè³ªå€ä½ (+5%)": 0.05, "ä¸­ä¸Šå€ä½ (+3%)": 0.03, "ä¸­ä¸‹å€ä½ (+0%)": 0.0}
    # [ä¿®æ”¹] å°‡é è¨­ç´¢å¼•è¨­ç‚º 1 (å³æ¸…å–®ä¸­çš„ç¬¬äºŒé …: ä¸­ä¸Šå€ä½)
    selected_loc = st.selectbox("6. å€ä½ç­‰ç´š (äº¤é€š/ç”Ÿæ´»æ©Ÿèƒ½)", options=list(loc_options.keys()), index=1)
    loc_rate = loc_options[selected_loc]

    deco_options = {"ä¸­ç­‰è£ä¿® (+5%)": 0.05, "ç°¡æ˜“è£ä¿® (+3%)": 0.03, "ç„¡è£ä¿® (+0%)": 0.0}
    # [ä¿®æ”¹] å°‡é è¨­ç´¢å¼•è¨­ç‚º 1 (å³æ¸…å–®ä¸­çš„ç¬¬äºŒé …: ç°¡æ˜“è£ä¿®)
    selected_deco = st.selectbox("7. è£ä¿®ç­‰ç´š (æ”¶ç´/å¤©åœ°å£)", options=list(deco_options.keys()), index=1)
    deco_rate = deco_options[selected_deco]

    # è¨­å‚™é‚è¼¯ (æ•´å±¤ä¸Šé™2000, å¥—æˆ¿ä¸Šé™1000)
    max_equip = 2000 if house_type == "æ•´å±¤(æˆ¶)" else 1000
    equip_add = st.number_input(f"8. è¨­å‚™å¤–åŠ  (æœ€é«˜ {max_equip})", min_value=0, max_value=max_equip, step=100)

# ==========================================
# 4. è¨ˆç®—é‚è¼¯
# ==========================================

# æŸ¥è¡¨æ‰¾å–®åƒ¹
base_price = 0
try:
    if not current_df.empty:
        row = current_df[current_df['è¡Œæ”¿å€'] == selected_district]
        if not row.empty:
            base_price = row[selected_age].values[0]
except:
    st.error("æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªé¸é …")

# å–å¾—ä¸Šé™
limit_cap = get_rent_limit(selected_county, house_type)

# è¨ˆç®—å…¬å¼
# R_max = P_ref * (1 + Loc + Deco) * Area + Equip
adjusted_price_per_ping = base_price * (1 + loc_rate + deco_rate)
rent_total = round(adjusted_price_per_ping * area + equip_add)

# ==========================================
# 5. é¡¯ç¤ºçµæœ
# ==========================================
st.markdown("---")
st.subheader("ğŸ“Š è©¦ç®—çµæœ")

c1, c2, c3 = st.columns(3)
with c1:
    st.metric("åŸå§‹å–®åƒ¹åƒè€ƒå€¼", f"${base_price}/åª")
with c2:
    st.metric("èª¿æ•´å¾Œå–®åƒ¹", f"${round(adjusted_price_per_ping, 2)}/åª")
with c3:
    st.metric("è¨­å‚™å¤–åŠ ", f"${equip_add}")

st.markdown("### ğŸ“ ç§Ÿé‡‘ç¸½é¡ä¸Šé™ (å‹™å¿…æ‰‹å‹•è¦ªè‡ªå†ç®—ä¸€æ¬¡!!)")

if rent_total <= limit_cap:
    st.success(f"## NT$ {rent_total:,} å…ƒ")
    st.info(f"âœ… ç¬¦åˆã€{selected_county} - {house_type}ã€‘æ”¶ä»¶ä¸Šé™ ({limit_cap:,}å…ƒ)")
else:
    st.error(f"## NT$ {rent_total:,} å…ƒ")
    st.warning(f"âš ï¸ è¶…éã€{selected_county} - {house_type}ã€‘æ”¶ä»¶ä¸Šé™ ({limit_cap:,}å…ƒ)ï¼Œè«‹ä»¥ {limit_cap:,} å…ƒç‚ºç°½ç´„ç§Ÿé‡‘ä¸Šé™ã€‚")

# è©³ç´°è¨ˆç®—éç¨‹
with st.expander("æŸ¥çœ‹è©³ç´°è¨ˆç®—å…¬å¼"):
    st.latex(r"R_{max} = P_{ref} \times (1 + \delta_{L} + \delta_{D}) \times A_{area} + \Delta_{E}")
    st.write(f"1. åƒè€ƒå–®åƒ¹ (P_ref): {base_price}")
    st.write(f"2. åŠ æˆä¿‚æ•¸: 1 + {loc_rate}(å€ä½) + {deco_rate}(è£ä¿®) = {1 + loc_rate + deco_rate}")
    st.write(f"3. èª¿æ•´å¾Œå–®åƒ¹: {base_price} * {1 + loc_rate + deco_rate} = {round(adjusted_price_per_ping, 4)}")
    st.write(f"4. ä¹˜ä¸Šåªæ•¸: {round(adjusted_price_per_ping, 4)} * {area} = {round(adjusted_price_per_ping * area)}")
    st.write(f"5. åŠ ä¸Šè¨­å‚™: + {equip_add}")
    st.write(f"6. ç¸½è¨ˆ: {rent_total}")
